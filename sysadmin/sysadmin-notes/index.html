<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Overview - My Notes</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Overview";
        var mkdocs_page_input_path = "sysadmin/sysadmin-notes.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> My Notes
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../backup/backup-notes/">Backup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../cli/cli-notes/">CLI</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../containers/container-notes/">Containers</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">DNS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../dns/dns-notes/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Configs</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../dns/configs/blocky-config.yml">blocky-config.yml</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../dns/configs/unbound.conf">unbound.conf</a>
                </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../git/git-notes/">Git</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Network</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../network/networking-notes/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../network/cisco-notes/">Cisco</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Configs</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../network/configs/interfaces">interfaces</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../network/configs/nftables.conf">nftables.conf</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Sysadmin</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Overview</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#list-for-basic-setup">List for basic setup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tips-and-tricks">Tips and tricks</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#add-user-to-use-as-a-service">Add user to use as a service</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#change-permission">Change permission</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#wireguard">Wireguard</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#smartmontools">Smartmontools</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#commands">Commands</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#understanding-smart-attributes">Understanding SMART attributes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#disks">Disks</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#luks">Luks</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#safetely-remove-a-sata-disk-from-a-running-system">Safetely remove a SATA disk from a running system</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../databases-notes/">Databases</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../erpnext-notes/">ERPNext</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wordpress-notes/">WordPress</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../selinux-notes/">SELinux</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >CoreOS</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../fedora-coreos/fedora-coreos-notes/">Fedora coreOS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fedora-coreos/basic.bu">basic.bu</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Systemd Examples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../systemd_examples/app.service">app.service</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../systemd_examples/freedns.service">freedns.service</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../systemd_examples/freedns.timer">freedns.timer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../systemd_examples/rclone.service">rclone.service</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Configs</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../configs/sshd_config">sshd_config</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Scripts</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../scripts/wg-gen.sh">wg-gen.sh</a>
                </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../virtual-machine/virtual-machine-notes/">Virtual Machine</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../web/web-server-notes/">Web</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">My Notes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Sysadmin</li>
      <li class="breadcrumb-item active">Overview</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="sysadmin-notes">Sysadmin notes</h1>
<h2 id="list-for-basic-setup">List for basic setup</h2>
<ul>
<li>[ ] Add ssh key</li>
<li>[ ] Configure ssh</li>
<li>[ ] Enable a firewall</li>
<li>[ ] Enable zram</li>
<li>[ ] Configure automatic security updates</li>
<li>[ ] Setup hostname and timezone</li>
<li>[ ] If ssd you may enable /tmp on tmpfs</li>
</ul>
<h2 id="tips-and-tricks">Tips and tricks</h2>
<h3 id="add-user-to-use-as-a-service">Add user to use as a service</h3>
<p>When you run a service, you should consider using a different user
 in order to not run as root or as a user with access to private
 information. This user does not has shell access and the home is
 usually where the aplication is stored.</p>
<pre><code class="language-sh"># No storage needed
sudo adduser --home /var/empty/service --system  --shell /sbin/nologin service
# Persistent storage needed
sudo adduser --home /var/lib/service --system  --shell /sbin/nologin service
</code></pre>
<h3 id="change-permission">Change permission</h3>
<p>When you want to change permissions on a recursive way, when you
 come across directories you got to be careful because they need
 to have executable permissions in order to be able to explore
 them, but you may not want to give this permissions to the files.</p>
<p>So we use this for directories</p>
<pre><code class="language-sh">find /dir -type d -exec chmod 755 {} \;
# Readonly
find /dir -type d -exec chmod 500 {} \;
</code></pre>
<p>And use this for files</p>
<pre><code class="language-sh">find /dir -type f -exec chmod 644 {} \;
# Read only
find /dir -type f -exec chmod 400 {} \;
</code></pre>
<h2 id="wireguard">Wireguard</h2>
<p>For setting up a wireguard server, you need a compatible kernel
 and the wireguard tools, the wireguard config you can build it
 yourself using <a href="https://fedoramagazine.org/build-a-virtual-private-network-with-wireguard/">this</a>
 just remember that if you need forwarding packets, you should
 allow it in your firewall, in firewalld:</p>
<pre><code class="language-sh">firewall-cmd --add-forward
firewall-cmd --add-masquerade
</code></pre>
<p>And to add to your <code>/etc/sysctl.conf</code></p>
<pre><code class="language-sysctl">net.ipv4.ip_forward=1
net.ipv6.conf.all.forwarding=1
</code></pre>
<h2 id="smartmontools">Smartmontools</h2>
<h3 id="commands">Commands</h3>
<ul>
<li>Show all info</li>
</ul>
<pre><code class="language-sh">sudo smartctl -a /dev/sdX
</code></pre>
<ul>
<li>Run a short test</li>
</ul>
<pre><code class="language-sh">sudo smartctl -t short /dev/sdX
</code></pre>
<ul>
<li>Run a long test</li>
</ul>
<pre><code class="language-sh">sudo smartctl -t long /dev/sdX
</code></pre>
<h3 id="understanding-smart-attributes">Understanding SMART attributes</h3>
<p>Some notes of the meaning of each smart attribute, this
 just apply to mechanical disks</p>
<table>
<thead>
<tr>
<th>ATTRIBUTE_NAME</th>
<th>Meaning</th>
<th>Best value</th>
</tr>
</thead>
<tbody>
<tr>
<td>G-SENSE RATE</td>
<td>Impacts detected when the disk was powered on</td>
<td>Lower better</td>
</tr>
<tr>
<td>REALOCATE SECTOR COUNTS</td>
<td>The name</td>
<td>Normal to have a few</td>
</tr>
<tr>
<td>CURRENT PENDING SECTOR</td>
<td>Bad shutdown</td>
<td>1 can be fixed</td>
</tr>
<tr>
<td>OFFLINE UNCORRECTABLE</td>
<td>Failed sector</td>
<td>More than 0 and the disk is diying</td>
</tr>
<tr>
<td>ULTRA DMA CRC ERROR</td>
<td>Problem with the wire or controller</td>
<td>Lower better</td>
</tr>
<tr>
<td>LOAD CYCLE COUNT</td>
<td>Head stopped for inativity</td>
<td>Less than 150K</td>
</tr>
<tr>
<td>LOAD RETRY COUNT</td>
<td>Head retrying enter the disk</td>
<td>Lower better</td>
</tr>
</tbody>
</table>
<h2 id="disks">Disks</h2>
<h3 id="luks">Luks</h3>
<p><strong>To open a luks encrypted disk</strong></p>
<pre><code class="language-sh">cryptsetup open /dev/sdX name
</code></pre>
<p><strong>Encrypt a disk with luks</strong></p>
<pre><code class="language-sh">cryptsetup --cipher aes-xts-plain64 --key-size 512 --hash sha512 --iter-time 5000 --use-urandom luksFormat /dev/sdXn
</code></pre>
<p><strong>Header backup</strong></p>
<pre><code class="language-sh">cryptsetup luksHeaderBackup --header-backup-file /root/sdXn.header.bak /dev/sdXn
</code></pre>
<h3 id="safetely-remove-a-sata-disk-from-a-running-system">Safetely remove a SATA disk from a running system</h3>
<ol>
<li>Unmount any filesystems on the disk. (<code>umount ...</code>)</li>
<li>Deactivate any LVM groups. (<code>vgchange -an</code>)</li>
<li>Make sure nothing is using the disk for anything.</li>
<li>Spin the HDD down. (irrelevant for SSD's) (<code>hdparm -Y /dev/sdX</code>)</li>
<li>Tell the system, that we are unplugging the HDD. (<code>echo 1 | sudo tee /sys/block/sdX/device/delete</code></li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../network/configs/nftables.conf" class="btn btn-neutral float-left" title="nftables.conf"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../databases-notes/" class="btn btn-neutral float-right" title="Databases">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../network/configs/nftables.conf" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../databases-notes/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
